<template>
  <div class="background-color"></div>
  <el-backtop
    class="hidden-sm-and-up"
    :right="40"
    :bottom="30"
    :visibility-height="300"
  />

  <el-container>
    <el-header style="padding: 0">
      <NavHeader @openSearch="handleOpenSearch" />
    </el-header>
    <el-row>
      <el-col :xs="0" :sm="4" :md="4" :lg="4" :xl="4">
        <NavAside class="hidden-xs-only" />
      </el-col>
      <!-- essay布局 -->
      <el-col
        v-if="route.path.split('/')[1] === 'essay'"
        :xs="24"
        :sm="20"
        :md="20"
        :lg="20"
        :xl="20"
      >
        <el-main>
          <keep-alive :max="5">
            <Essay ref="essayComponent"></Essay>
          </keep-alive>
        </el-main>
      </el-col>

      <!-- classify布局 -->
      <!-- 由于生命周期的问题 这里应该这么写 不能用classify -->
      <el-col
        v-if="route.path.split('/')[1] !== 'essay'"
        :xs="24"
        :sm="16"
        :md="16"
        :lg="16"
        :xl="16"
      >
        <el-main>
          <router-view v-slot="{ Component }">
            <keep-alive :max="5">
              <component :is="Component"> </component>
            </keep-alive>
          </router-view>
        </el-main>
      </el-col>
    </el-row>
  </el-container>

  <div style="width: 100%">
    <footer class="register">
      <a class="text-sm" target="_blank" href="https://github.com/Lijingwoquan"
        >© 2024 罹景偓佺的博客 By 罹景.本站博客未经授权禁止转载.
      </a>
      <a
        class="text-sm"
        target="_blank"
        href="https://beian.miit.gov.cn/#/Integrated/index"
        >备案信息:湘ICP备2024043210号.</a
      >
    </footer>
  </div>
</template>

<script setup>
import { ref, onMounted, watch, defineAsyncComponent } from "vue";
import { useRoute } from "vue-router";
const NavHeader = defineAsyncComponent(() =>
  import("~/components/user/NavHeader.vue")
);
const NavAside = defineAsyncComponent(() =>
  import("~/components/user/NavAside.vue")
);
const Essay = defineAsyncComponent(() => import("~/pages/userEssay/list.vue"));

const ifToEssay = ref(false);
const route = useRoute();

const essayComponent = ref(null);

const handleOpenSearch = () => {
  if (essayComponent.value) {
    essayComponent.value.showAnchorIcon();
  }
};

onMounted(() => {
  if (route.fullPath.split("/")[1] === "essay") {
    ifToEssay.value = true;
  }
});

watch(
  () => route.path,
  () => {
    ifToEssay.value = false;
    if (route.path.split("/")[1] === "essay") {
      ifToEssay.value = true;
    }
  }
);
</script>

<style scoped>
.el-main {
  padding: 0;
}

.register {
  @apply flex flex-col justify-center items-center italic mt-10 mb-5;
}

.background-color {
  /* position: fixed;
  top: 60px;
  height: calc(100vh - 60px);
  width: 100vw;
  background: linear-gradient(
    to right bottom,
    rgba(180, 174, 206, 0.1),
    rgba(137, 155, 231, 0.15)
  );
  z-index: 10;
  pointer-events: none; */
}
</style>
